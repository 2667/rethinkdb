cmake_minimum_required(VERSION 3.10)

# Use ccache if it's installed to speed up repeated builds
find_program(CCACHE_PROGRAM ccache)
if (CCACHE_PROGRAM)
    set_property(GLOBAL PROPERTY RULE_LAUNCH_COMPILE "${CCACHE_PROGRAM}")
endif()

project(rebirthdb)

option(VERBOSE "Build with verbose output" OFF)
option(DEPENDS_DEBUG_MODE "Print list of dependencies after configuration" OFF)

set(CMAKE_CXX_STANDARD 11)
set(CMAKE_VERBOSE_MAKEFILE ${VERBOSE})
set(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)
set_property(GLOBAL PROPERTY GLOBAL_DEPENDS_DEBUG_MODE ${DEPENDS_DEBUG_MODE})

include(defaults)
include(boost)
include(zlib)
include(protobuf)
include(re2)
include(duktape)
include(libidn)
include(jemalloc)
include(openssl)
include(curl)
include(gtest)

include(util/touch_static_libs)

add_definitions(${ADD_CFLAGS}
        -DPRODUCT_NAME="${PRODUCT_NAME}"
        -DRETHINKDB_VERSION="${RETHINKDB_VERSION}"
        -DENABLE_TLS
        -DRAPIDJSON_HAS_STDSTRING   # Enable RapidJSON std::string functions
        -DRAPIDJSON_PARSE_DEFAULT_FLAGS=kParseFullPrecisionFlag # Enable RapidJSON std::string functions
        -D_FILE_OFFSET_BITS=64  # Force 64-bit off_t size on Linux
        -D__STDC_LIMIT_MACROS
        -D__STDC_FORMAT_MACROS
        )

include_directories(${boost_INCLUDE_DIR})
include_directories(${zlib_INCLUDE_DIR})
include_directories(${re2_INCLUDE_DIR})
include_directories(${protobuf_INCLUDE_DIRS})
include_directories(${proto_INCLUDE_DIR})
include_directories(${duktape_INCLUDE_DIR})
include_directories(${libidn_INCLUDE_DIR})
include_directories(${jemalloc_INCLUDE_DIRS})
include_directories(${openssl_INCLUDE_DIRS})
include_directories(${curl_INCLUDE_DIR})
include_directories(${gtest_INCLUDE_DIRS})

include_directories(src)
include_directories(src/arch)
include_directories(src/arch/io)
include_directories(src/arch/io/disk)
include_directories(src/arch/io/timer)
include_directories(src/arch/runtime)
include_directories(src/arch/runtime/event_queue)
include_directories(src/arch/runtime/system_event)
include_directories(src/btree)
include_directories(src/buffer_cache)
include_directories(src/cjson)
include_directories(src/client_protocol)
include_directories(src/clustering/administration)
include_directories(src/clustering/administration/auth)
include_directories(src/clustering/administration/http)
include_directories(src/clustering/administration/issues)
include_directories(src/clustering/administration/jobs)
include_directories(src/clustering/administration/logs)
include_directories(src/clustering/administration/main)
include_directories(src/clustering/administration/persist)
include_directories(src/clustering/administration/persist/migrate)
include_directories(src/clustering/administration/servers)
include_directories(src/clustering/administration/stats)
include_directories(src/clustering/administration/tables)
include_directories(src/clustering/generic)
include_directories(src/clustering/immediate_consistency)
include_directories(src/clustering/query_routing)
include_directories(src/clustering/table_contract)
include_directories(src/clustering/table_contract/coordinator)
include_directories(src/clustering/table_contract/executor)
include_directories(src/clustering/table_manager)
include_directories(src/concurrency)
include_directories(src/concurrency/queue)
include_directories(src/config)
include_directories(src/containers)
include_directories(src/containers/archive)
include_directories(src/crypto)
include_directories(src/extproc)
include_directories(src/http)
include_directories(src/parsing)
include_directories(src/perfmon)
include_directories(src/pprint)
include_directories(src/rapidjson)
include_directories(src/rapidjson/error)
include_directories(src/rapidjson/internal)
include_directories(src/rdb_protocol)
include_directories(src/rdb_protocol/artificial_table)
include_directories(src/rdb_protocol/datum_stream)
include_directories(src/rdb_protocol/geo)
include_directories(src/rdb_protocol/geo/karney)
include_directories(src/rdb_protocol/geo/s2)
include_directories(src/rdb_protocol/geo/s2/base)
include_directories(src/rdb_protocol/geo/s2/strings)
include_directories(src/rdb_protocol/geo/s2/util/coding)
include_directories(src/rdb_protocol/geo/s2/util/hash)
include_directories(src/rdb_protocol/geo/s2/util/math)
include_directories(src/rdb_protocol/geo/s2/util/math/exactfloat)
include_directories(src/rdb_protocol/terms)
include_directories(src/region)
include_directories(src/rpc)
include_directories(src/rpc/connectivity)
include_directories(src/rpc/directory)
include_directories(src/rpc/mailbox)
include_directories(src/rpc/semilattice)
include_directories(src/rpc/semilattice/joins)
include_directories(src/rpc/semilattice/view)
include_directories(src/serializer)
include_directories(src/serializer/log)
include_directories(src/serializer/log/lba)
include_directories(src/unittest)

if (${MSVC} OR ${WIN32})
    include_directories(src/arch/windows_stub)
    include_directories(src/arch/windows_stub/sys)
    include_directories(src/rapidjson/msinttypes)
    include_directories(src/rdb_protocol/geo/s2/util/endian)
endif()


set(rebirthdb_SOURCES)

list(APPEND rebirthdb_SOURCES
        ${PROTO_SRC}
        ${PROTO_HDR}
        ${duktape_SRC})

list(APPEND rebirthdb_SOURCES
        src/arch/io/disk/accounting.cc
        src/arch/io/disk/accounting.hpp
        src/arch/io/disk/conflict_resolving.cc
        src/arch/io/disk/conflict_resolving.hpp
        src/arch/io/disk/filestat.cc
        src/arch/io/disk/filestat.hpp
        src/arch/io/disk/pool.cc
        src/arch/io/disk/pool.hpp
        src/arch/io/disk/stats.cc
        src/arch/io/disk/stats.hpp
        src/arch/io/disk/stats_2.cc
        src/arch/io/disk/stats_2.hpp
        src/arch/io/timer/timer_kqueue_provider.cc
        src/arch/io/timer/timer_kqueue_provider.hpp
        src/arch/io/timer/timer_signal_provider.cc
        src/arch/io/timer/timer_signal_provider.hpp
        src/arch/io/timer/timer_windows_provider.cc
        src/arch/io/timer/timer_windows_provider.hpp
        src/arch/io/timer/timerfd_provider.cc
        src/arch/io/timer/timerfd_provider.hpp
        src/arch/io/blocker_pool.cc
        src/arch/io/blocker_pool.hpp
        src/arch/io/concurrency.hpp
        src/arch/io/disk.cc
        src/arch/io/disk.hpp
        src/arch/io/event_watcher.cc
        src/arch/io/event_watcher.hpp
        src/arch/io/io_utils.cc
        src/arch/io/io_utils.hpp
        src/arch/io/network.cc
        src/arch/io/network.hpp
        src/arch/io/openssl.hpp
        src/arch/io/timer_provider.hpp
        src/arch/runtime/event_queue/epoll.cc
        src/arch/runtime/event_queue/epoll.hpp
        src/arch/runtime/event_queue/iocp.cc
        src/arch/runtime/event_queue/iocp.hpp
        src/arch/runtime/event_queue/kqueue.cc
        src/arch/runtime/event_queue/kqueue.hpp
        src/arch/runtime/event_queue/poll.cc
        src/arch/runtime/event_queue/poll.hpp
        src/arch/runtime/system_event/eventfd.cc
        src/arch/runtime/system_event/eventfd.hpp
        src/arch/runtime/system_event/eventfd_event.cc
        src/arch/runtime/system_event/eventfd_event.hpp
        src/arch/runtime/system_event/pipe_event.cc
        src/arch/runtime/system_event/pipe_event.hpp
        src/arch/runtime/system_event/windows_event.cc
        src/arch/runtime/system_event/windows_event.hpp
        src/arch/runtime/callable_action.hpp
        src/arch/runtime/context_switching.cc
        src/arch/runtime/context_switching.hpp
        src/arch/runtime/coro_profiler.cc
        src/arch/runtime/coro_profiler.hpp
        src/arch/runtime/coroutines.cc
        src/arch/runtime/coroutines.hpp
        src/arch/runtime/event_queue.cc
        src/arch/runtime/event_queue.hpp
        src/arch/runtime/event_queue_types.hpp
        src/arch/runtime/message_hub.cc
        src/arch/runtime/message_hub.hpp
        src/arch/runtime/runtime.cc
        src/arch/runtime/runtime.hpp
        src/arch/runtime/runtime_utils.cc
        src/arch/runtime/runtime_utils.hpp
        src/arch/runtime/starter.hpp
        src/arch/runtime/system_event.hpp
        src/arch/runtime/thread_pool.cc
        src/arch/runtime/thread_pool.hpp
        src/arch/windows_stub/sys/uio.h
        src/arch/windows_stub/unistd.h
        src/arch/address.cc
        src/arch/address.hpp
        src/arch/arch.cc
        src/arch/arch.hpp
        src/arch/barrier.cc
        src/arch/barrier.hpp
        src/arch/compiler.hpp
        src/arch/fd_send_recv.cc
        src/arch/fd_send_recv.hpp
        src/arch/filesystem.hpp
        src/arch/os_signal.cc
        src/arch/os_signal.hpp
        src/arch/process.hpp
        src/arch/spinlock.cc
        src/arch/spinlock.hpp
        src/arch/timer.cc
        src/arch/timer.hpp
        src/arch/timing.cc
        src/arch/timing.hpp
        src/arch/types.cc
        src/arch/types.hpp
        src/btree/backfill.cc
        src/btree/backfill.hpp
        src/btree/backfill_debug.cc
        src/btree/backfill_debug.hpp
        src/btree/concurrent_traversal.cc
        src/btree/concurrent_traversal.hpp
        src/btree/depth_first_traversal.cc
        src/btree/depth_first_traversal.hpp
        src/btree/get_distribution.cc
        src/btree/get_distribution.hpp
        src/btree/internal_node.cc
        src/btree/internal_node.hpp
        src/btree/keys.cc
        src/btree/keys.hpp
        src/btree/leaf_node.cc
        src/btree/leaf_node.hpp
        src/btree/node.cc
        src/btree/node.hpp
        src/btree/operations.cc
        src/btree/operations.hpp
        src/btree/parallel_traversal.cc
        src/btree/parallel_traversal.hpp
        src/btree/reql_specific.cc
        src/btree/reql_specific.hpp
        src/btree/secondary_operations.cc
        src/btree/secondary_operations.hpp
        src/btree/superblock.hpp
        src/btree/traversal_progress.cc
        src/btree/traversal_progress.hpp
        src/btree/types.hpp
        src/buffer_cache/alt.cc
        src/buffer_cache/alt.hpp
        src/buffer_cache/blob.cc
        src/buffer_cache/blob.hpp
        src/buffer_cache/block_version.hpp
        src/buffer_cache/cache_account.cc
        src/buffer_cache/cache_account.hpp
        src/buffer_cache/cache_balancer.cc
        src/buffer_cache/cache_balancer.hpp
        src/buffer_cache/evicter.cc
        src/buffer_cache/evicter.hpp
        src/buffer_cache/eviction_bag.cc
        src/buffer_cache/eviction_bag.hpp
        src/buffer_cache/free_list.cc
        src/buffer_cache/free_list.hpp
        src/buffer_cache/page.cc
        src/buffer_cache/page.hpp
        src/buffer_cache/page_cache.cc
        src/buffer_cache/page_cache.hpp
        src/buffer_cache/serialize_onto_blob.cc
        src/buffer_cache/serialize_onto_blob.hpp
        src/buffer_cache/stats.cc
        src/buffer_cache/stats.hpp
        src/buffer_cache/types.cc
        src/buffer_cache/types.hpp
        src/cjson/cJSON.cc
        src/cjson/cJSON.hpp
        src/cjson/json.cc
        src/cjson/json.hpp
        src/client_protocol/client_server_error.hpp
        src/client_protocol/json.cc
        src/client_protocol/json.hpp
        src/client_protocol/protocols.cc
        src/client_protocol/protocols.hpp
        src/client_protocol/server.cc
        src/client_protocol/server.hpp
        src/clustering/administration/auth/authentication_error.hpp
        src/clustering/administration/auth/base_artificial_table_backend.hpp
        src/clustering/administration/auth/base_authenticator.hpp
        src/clustering/administration/auth/grant.cc
        src/clustering/administration/auth/grant.hpp
        src/clustering/administration/auth/password.cc
        src/clustering/administration/auth/password.hpp
        src/clustering/administration/auth/permission_error.hpp
        src/clustering/administration/auth/permissions.cc
        src/clustering/administration/auth/permissions.hpp
        src/clustering/administration/auth/permissions_artificial_table_backend.cc
        src/clustering/administration/auth/permissions_artificial_table_backend.hpp
        src/clustering/administration/auth/plaintext_authenticator.cc
        src/clustering/administration/auth/plaintext_authenticator.hpp
        src/clustering/administration/auth/scram_authenticator.cc
        src/clustering/administration/auth/scram_authenticator.hpp
        src/clustering/administration/auth/user.cc
        src/clustering/administration/auth/user.hpp
        src/clustering/administration/auth/user_context.cc
        src/clustering/administration/auth/user_context.hpp
        src/clustering/administration/auth/username.cc
        src/clustering/administration/auth/username.hpp
        src/clustering/administration/auth/users_artificial_table_backend.cc
        src/clustering/administration/auth/users_artificial_table_backend.hpp
        src/clustering/administration/http/cyanide.hpp
        src/clustering/administration/http/server.cc
        src/clustering/administration/http/server.hpp
        src/clustering/administration/issues/issue.cc
        src/clustering/administration/issues/issue.hpp
        src/clustering/administration/issues/issues_backend.cc
        src/clustering/administration/issues/issues_backend.hpp
        src/clustering/administration/issues/local.cc
        src/clustering/administration/issues/local.hpp
        src/clustering/administration/issues/log_write.cc
        src/clustering/administration/issues/log_write.hpp
        src/clustering/administration/issues/memory.cc
        src/clustering/administration/issues/memory.hpp
        src/clustering/administration/issues/name_collision.cc
        src/clustering/administration/issues/name_collision.hpp
        src/clustering/administration/issues/non_transitive.cc
        src/clustering/administration/issues/non_transitive.hpp
        src/clustering/administration/issues/outdated_index.cc
        src/clustering/administration/issues/outdated_index.hpp
        src/clustering/administration/issues/table.cc
        src/clustering/administration/issues/table.hpp
        src/clustering/administration/jobs/backend.cc
        src/clustering/administration/jobs/backend.hpp
        src/clustering/administration/jobs/manager.cc
        src/clustering/administration/jobs/manager.hpp
        src/clustering/administration/jobs/report.cc
        src/clustering/administration/jobs/report.hpp
        src/clustering/administration/jobs/report.tcc
        src/clustering/administration/logs/log_transfer.cc
        src/clustering/administration/logs/log_transfer.hpp
        src/clustering/administration/logs/log_writer.cc
        src/clustering/administration/logs/log_writer.hpp
        src/clustering/administration/logs/logs_backend.cc
        src/clustering/administration/logs/logs_backend.hpp
        src/clustering/administration/main/cache_size.cc
        src/clustering/administration/main/cache_size.hpp
        src/clustering/administration/main/command_line.cc
        src/clustering/administration/main/command_line.hpp
        src/clustering/administration/main/directory_lock.cc
        src/clustering/administration/main/directory_lock.hpp
        src/clustering/administration/main/initial_join.cc
        src/clustering/administration/main/initial_join.hpp
        src/clustering/administration/main/memory_checker.cc
        src/clustering/administration/main/memory_checker.hpp
        src/clustering/administration/main/names.cc
        src/clustering/administration/main/names.hpp
        src/clustering/administration/main/options.cc
        src/clustering/administration/main/options.hpp
        src/clustering/administration/main/path.cc
        src/clustering/administration/main/path.hpp
        src/clustering/administration/main/ports.hpp
        src/clustering/administration/main/serve.cc
        src/clustering/administration/main/serve.hpp
        src/clustering/administration/main/version_check.cc
        src/clustering/administration/main/version_check.hpp
        src/clustering/administration/main/watchable_fields.hpp
        src/clustering/administration/main/windows_service.cc
        src/clustering/administration/main/windows_service.hpp
        src/clustering/administration/persist/migrate/metadata_v1_14.cc
        src/clustering/administration/persist/migrate/metadata_v1_14.hpp
        src/clustering/administration/persist/migrate/metadata_v1_16.cc
        src/clustering/administration/persist/migrate/metadata_v1_16.hpp
        src/clustering/administration/persist/migrate/metadata_v2_1.cc
        src/clustering/administration/persist/migrate/metadata_v2_1.hpp
        src/clustering/administration/persist/migrate/migrate_v1_14.cc
        src/clustering/administration/persist/migrate/migrate_v1_14.hpp
        src/clustering/administration/persist/migrate/migrate_v1_16.cc
        src/clustering/administration/persist/migrate/migrate_v1_16.hpp
        src/clustering/administration/persist/migrate/migrate_v2_1.cc
        src/clustering/administration/persist/migrate/migrate_v2_1.hpp
        src/clustering/administration/persist/migrate/migrate_v2_3.cc
        src/clustering/administration/persist/migrate/migrate_v2_3.hpp
        src/clustering/administration/persist/migrate/rewrite.hpp
        src/clustering/administration/persist/branch_history_manager.cc
        src/clustering/administration/persist/branch_history_manager.hpp
        src/clustering/administration/persist/file.cc
        src/clustering/administration/persist/file.hpp
        src/clustering/administration/persist/file_keys.cc
        src/clustering/administration/persist/file_keys.hpp
        src/clustering/administration/persist/raft_storage_interface.cc
        src/clustering/administration/persist/raft_storage_interface.hpp
        src/clustering/administration/persist/semilattice.cc
        src/clustering/administration/persist/semilattice.hpp
        src/clustering/administration/persist/table_interface.cc
        src/clustering/administration/persist/table_interface.hpp
        src/clustering/administration/servers/auto_reconnect.cc
        src/clustering/administration/servers/auto_reconnect.hpp
        src/clustering/administration/servers/config_client.cc
        src/clustering/administration/servers/config_client.hpp
        src/clustering/administration/servers/config_server.cc
        src/clustering/administration/servers/config_server.hpp
        src/clustering/administration/servers/network_logger.cc
        src/clustering/administration/servers/network_logger.hpp
        src/clustering/administration/servers/server_common.cc
        src/clustering/administration/servers/server_common.hpp
        src/clustering/administration/servers/server_config.cc
        src/clustering/administration/servers/server_config.hpp
        src/clustering/administration/servers/server_metadata.cc
        src/clustering/administration/servers/server_metadata.hpp
        src/clustering/administration/servers/server_status.cc
        src/clustering/administration/servers/server_status.hpp
        src/clustering/administration/stats/debug_stats_backend.cc
        src/clustering/administration/stats/debug_stats_backend.hpp
        src/clustering/administration/stats/request.cc
        src/clustering/administration/stats/request.hpp
        src/clustering/administration/stats/stat_manager.cc
        src/clustering/administration/stats/stat_manager.hpp
        src/clustering/administration/stats/stats_backend.cc
        src/clustering/administration/stats/stats_backend.hpp
        src/clustering/administration/tables/calculate_status.cc
        src/clustering/administration/tables/calculate_status.hpp
        src/clustering/administration/tables/database_metadata.hpp
        src/clustering/administration/tables/db_config.cc
        src/clustering/administration/tables/db_config.hpp
        src/clustering/administration/tables/debug_table_status.cc
        src/clustering/administration/tables/debug_table_status.hpp
        src/clustering/administration/tables/generate_config.cc
        src/clustering/administration/tables/generate_config.hpp
        src/clustering/administration/tables/name_resolver.cc
        src/clustering/administration/tables/name_resolver.hpp
        src/clustering/administration/tables/split_points.cc
        src/clustering/administration/tables/split_points.hpp
        src/clustering/administration/tables/table_common.cc
        src/clustering/administration/tables/table_common.hpp
        src/clustering/administration/tables/table_config.cc
        src/clustering/administration/tables/table_config.hpp
        src/clustering/administration/tables/table_metadata.cc
        src/clustering/administration/tables/table_metadata.hpp
        src/clustering/administration/tables/table_status.cc
        src/clustering/administration/tables/table_status.hpp
        src/clustering/administration/admin_op_exc.hpp
        src/clustering/administration/artificial_reql_cluster_interface.cc
        src/clustering/administration/artificial_reql_cluster_interface.hpp
        src/clustering/administration/cluster_config.cc
        src/clustering/administration/cluster_config.hpp
        src/clustering/administration/datum_adapter.cc
        src/clustering/administration/datum_adapter.hpp
        src/clustering/administration/metadata.cc
        src/clustering/administration/metadata.hpp
        src/clustering/administration/namespace_interface_repository.cc
        src/clustering/administration/namespace_interface_repository.hpp
        src/clustering/administration/perfmon_collection_repo.cc
        src/clustering/administration/perfmon_collection_repo.hpp
        src/clustering/administration/real_reql_cluster_interface.cc
        src/clustering/administration/real_reql_cluster_interface.hpp
        src/clustering/generic/minidir.hpp
        src/clustering/generic/minidir.tcc
        src/clustering/generic/multi_client_client.cc
        src/clustering/generic/multi_client_client.hpp
        src/clustering/generic/multi_client_metadata.hpp
        src/clustering/generic/multi_client_server.hpp
        src/clustering/generic/nonoverlapping_regions.cc
        src/clustering/generic/nonoverlapping_regions.hpp
        src/clustering/generic/raft_core.cc
        src/clustering/generic/raft_core.hpp
        src/clustering/generic/raft_core.tcc
        src/clustering/generic/raft_network.hpp
        src/clustering/generic/raft_network.tcc
        src/clustering/generic/registrant.hpp
        src/clustering/generic/registrar.hpp
        src/clustering/generic/registration_metadata.hpp
        src/clustering/immediate_consistency/backfill_item_seq.hpp
        src/clustering/immediate_consistency/backfill_metadata.cc
        src/clustering/immediate_consistency/backfill_metadata.hpp
        src/clustering/immediate_consistency/backfill_throttler.hpp
        src/clustering/immediate_consistency/backfillee.cc
        src/clustering/immediate_consistency/backfillee.hpp
        src/clustering/immediate_consistency/backfiller.cc
        src/clustering/immediate_consistency/backfiller.hpp
        src/clustering/immediate_consistency/history.cc
        src/clustering/immediate_consistency/history.hpp
        src/clustering/immediate_consistency/local_replicator.cc
        src/clustering/immediate_consistency/local_replicator.hpp
        src/clustering/immediate_consistency/primary_dispatcher.cc
        src/clustering/immediate_consistency/primary_dispatcher.hpp
        src/clustering/immediate_consistency/remote_replicator_client.cc
        src/clustering/immediate_consistency/remote_replicator_client.hpp
        src/clustering/immediate_consistency/remote_replicator_metadata.cc
        src/clustering/immediate_consistency/remote_replicator_metadata.hpp
        src/clustering/immediate_consistency/remote_replicator_server.cc
        src/clustering/immediate_consistency/remote_replicator_server.hpp
        src/clustering/immediate_consistency/replica.cc
        src/clustering/immediate_consistency/replica.hpp
        src/clustering/immediate_consistency/standard_backfill_throttler.cc
        src/clustering/immediate_consistency/standard_backfill_throttler.hpp
        src/clustering/query_routing/direct_query_server.cc
        src/clustering/query_routing/direct_query_server.hpp
        src/clustering/query_routing/metadata.cc
        src/clustering/query_routing/metadata.hpp
        src/clustering/query_routing/primary_query_client.cc
        src/clustering/query_routing/primary_query_client.hpp
        src/clustering/query_routing/primary_query_server.cc
        src/clustering/query_routing/primary_query_server.hpp
        src/clustering/query_routing/table_query_client.cc
        src/clustering/query_routing/table_query_client.hpp
        src/clustering/table_contract/coordinator/calculate_contracts.cc
        src/clustering/table_contract/coordinator/calculate_contracts.hpp
        src/clustering/table_contract/coordinator/calculate_misc.cc
        src/clustering/table_contract/coordinator/calculate_misc.hpp
        src/clustering/table_contract/coordinator/check_ready.cc
        src/clustering/table_contract/coordinator/check_ready.hpp
        src/clustering/table_contract/coordinator/coordinator.cc
        src/clustering/table_contract/coordinator/coordinator.hpp
        src/clustering/table_contract/executor/exec.cc
        src/clustering/table_contract/executor/exec.hpp
        src/clustering/table_contract/executor/exec_erase.cc
        src/clustering/table_contract/executor/exec_erase.hpp
        src/clustering/table_contract/executor/exec_primary.cc
        src/clustering/table_contract/executor/exec_primary.hpp
        src/clustering/table_contract/executor/exec_secondary.cc
        src/clustering/table_contract/executor/exec_secondary.hpp
        src/clustering/table_contract/executor/executor.cc
        src/clustering/table_contract/executor/executor.hpp
        src/clustering/table_contract/branch_history_gc.cc
        src/clustering/table_contract/branch_history_gc.hpp
        src/clustering/table_contract/contract_metadata.cc
        src/clustering/table_contract/contract_metadata.hpp
        src/clustering/table_contract/cpu_sharding.cc
        src/clustering/table_contract/cpu_sharding.hpp
        src/clustering/table_contract/emergency_repair.cc
        src/clustering/table_contract/emergency_repair.hpp
        src/clustering/table_manager/backfill_progress_tracker.cc
        src/clustering/table_manager/backfill_progress_tracker.hpp
        src/clustering/table_manager/flush_interval_manager.cc
        src/clustering/table_manager/flush_interval_manager.hpp
        src/clustering/table_manager/multi_table_manager.cc
        src/clustering/table_manager/multi_table_manager.hpp
        src/clustering/table_manager/server_name_cache_updater.cc
        src/clustering/table_manager/server_name_cache_updater.hpp
        src/clustering/table_manager/sindex_manager.cc
        src/clustering/table_manager/sindex_manager.hpp
        src/clustering/table_manager/table_manager.cc
        src/clustering/table_manager/table_manager.hpp
        src/clustering/table_manager/table_meta_client.cc
        src/clustering/table_manager/table_meta_client.hpp
        src/clustering/table_manager/table_metadata.cc
        src/clustering/table_manager/table_metadata.hpp
        src/concurrency/queue/accounting.hpp
        src/concurrency/queue/disk_backed_queue_wrapper.hpp
        src/concurrency/queue/limited_fifo.hpp
        src/concurrency/queue/passive_producer.hpp
        src/concurrency/queue/unlimited_fifo.hpp
        src/concurrency/access.hpp
        src/concurrency/auto_drainer.cc
        src/concurrency/auto_drainer.hpp
        src/concurrency/cache_line_padded.hpp
        src/concurrency/cond_var.cc
        src/concurrency/cond_var.hpp
        src/concurrency/coro_pool.hpp
        src/concurrency/cross_thread_mutex.cc
        src/concurrency/cross_thread_mutex.hpp
        src/concurrency/cross_thread_semaphore.hpp
        src/concurrency/cross_thread_signal.cc
        src/concurrency/cross_thread_signal.hpp
        src/concurrency/cross_thread_watchable.hpp
        src/concurrency/cross_thread_watchable.tcc
        src/concurrency/exponential_backoff.hpp
        src/concurrency/fifo_checker.cc
        src/concurrency/fifo_checker.hpp
        src/concurrency/fifo_enforcer.cc
        src/concurrency/fifo_enforcer.hpp
        src/concurrency/fifo_enforcer_queue.hpp
        src/concurrency/fifo_enforcer_queue.tcc
        src/concurrency/interruptor.cc
        src/concurrency/interruptor.hpp
        src/concurrency/mutex.cc
        src/concurrency/mutex.hpp
        src/concurrency/mutex_assertion.hpp
        src/concurrency/new_mutex.hpp
        src/concurrency/new_semaphore.cc
        src/concurrency/new_semaphore.hpp
        src/concurrency/one_per_thread.hpp
        src/concurrency/pmap.hpp
        src/concurrency/promise.hpp
        src/concurrency/pubsub.hpp
        src/concurrency/pump_coro.cc
        src/concurrency/pump_coro.hpp
        src/concurrency/rwlock.cc
        src/concurrency/rwlock.hpp
        src/concurrency/semaphore.cc
        src/concurrency/semaphore.hpp
        src/concurrency/signal.cc
        src/concurrency/signal.hpp
        src/concurrency/timestamp_enforcer.cc
        src/concurrency/timestamp_enforcer.hpp
        src/concurrency/wait_any.cc
        src/concurrency/wait_any.hpp
        src/concurrency/watchable.hpp
        src/concurrency/watchable.tcc
        src/concurrency/watchable_map.hpp
        src/concurrency/watchable_map.tcc
        src/concurrency/watchable_transform.hpp
        src/concurrency/watchable_transform.tcc
        src/concurrency/watchdog_timer.cc
        src/concurrency/watchdog_timer.hpp
        src/config/args.hpp
        src/containers/archive/archive.cc
        src/containers/archive/archive.hpp
        src/containers/archive/boost_types.hpp
        src/containers/archive/buffer_group_stream.cc
        src/containers/archive/buffer_group_stream.hpp
        src/containers/archive/buffer_stream.hpp
        src/containers/archive/file_stream.cc
        src/containers/archive/file_stream.hpp
        src/containers/archive/optional.hpp
        src/containers/archive/socket_stream.cc
        src/containers/archive/socket_stream.hpp
        src/containers/archive/stl_types.cc
        src/containers/archive/stl_types.hpp
        src/containers/archive/string_stream.cc
        src/containers/archive/string_stream.hpp
        src/containers/archive/tcp_conn_stream.cc
        src/containers/archive/tcp_conn_stream.hpp
        src/containers/archive/tuple.hpp
        src/containers/archive/varint.cc
        src/containers/archive/varint.hpp
        src/containers/archive/vector_stream.cc
        src/containers/archive/vector_stream.hpp
        src/containers/archive/versioned.hpp
        src/containers/auth_key.cc
        src/containers/auth_key.hpp
        src/containers/backindex_bag.hpp
        src/containers/binary_blob.cc
        src/containers/binary_blob.hpp
        src/containers/buffer_group.cc
        src/containers/buffer_group.hpp
        src/containers/clone_ptr.hpp
        src/containers/clone_ptr.tcc
        src/containers/counted.hpp
        src/containers/death_runner.hpp
        src/containers/disk_backed_queue.cc
        src/containers/disk_backed_queue.hpp
        src/containers/empty_value.hpp
        src/containers/half_intrusive_list.hpp
        src/containers/incremental_lenses.hpp
        src/containers/intrusive_list.hpp
        src/containers/intrusive_priority_queue.hpp
        src/containers/lazy_erase_vector.hpp
        src/containers/lifetime.hpp
        src/containers/lru_cache.hpp
        src/containers/map_sentries.hpp
        src/containers/name_string.cc
        src/containers/name_string.hpp
        src/containers/object_buffer.hpp
        src/containers/optional.hpp
        src/containers/printf_buffer.cc
        src/containers/printf_buffer.hpp
        src/containers/priority_queue.hpp
        src/containers/priority_queue.tcc
        src/containers/range_map.hpp
        src/containers/scoped.hpp
        src/containers/segmented_vector.hpp
        src/containers/shared_buffer.cc
        src/containers/shared_buffer.hpp
        src/containers/tribool.hpp
        src/containers/two_level_array.hpp
        src/containers/uuid.cc
        src/containers/uuid.hpp
        src/crypto/base64.cc
        src/crypto/base64.hpp
        src/crypto/compare_equal.hpp
        src/crypto/error.cc
        src/crypto/error.hpp
        src/crypto/hash.cc
        src/crypto/hash.hpp
        src/crypto/hmac.cc
        src/crypto/hmac.hpp
        src/crypto/initialization_guard.cc
        src/crypto/initialization_guard.hpp
        src/crypto/pbkcs5_pbkdf2_hmac.cc
        src/crypto/pbkcs5_pbkdf2_hmac.hpp
        src/crypto/random.cc
        src/crypto/random.hpp
        src/crypto/saslprep.cc
        src/crypto/saslprep.hpp
        src/extproc/extproc_job.cc
        src/extproc/extproc_job.hpp
        src/extproc/extproc_pool.cc
        src/extproc/extproc_pool.hpp
        src/extproc/extproc_spawner.cc
        src/extproc/extproc_spawner.hpp
        src/extproc/extproc_worker.cc
        src/extproc/extproc_worker.hpp
        src/extproc/http_job.cc
        src/extproc/http_job.hpp
        src/extproc/http_runner.cc
        src/extproc/http_runner.hpp
        src/extproc/js_job.cc
        src/extproc/js_job.hpp
        src/extproc/js_runner.cc
        src/extproc/js_runner.hpp
        src/gen/web_assets.cc
        src/http/file_app.cc
        src/http/file_app.hpp
        src/http/http.cc
        src/http/http.hpp
        src/http/http_parser.cc
        src/http/http_parser.hpp
        src/http/routing_app.cc
        src/http/routing_app.hpp
        src/http/web_assets.hpp
        src/parsing/utf8.cc
        src/parsing/utf8.hpp
        src/parsing/util.cc
        src/parsing/util.hpp
        src/perfmon/collect.cc
        src/perfmon/collect.hpp
        src/perfmon/core.cc
        src/perfmon/core.hpp
        src/perfmon/filter.cc
        src/perfmon/filter.hpp
        src/perfmon/perfmon.cc
        src/perfmon/perfmon.hpp
        src/perfmon/types.hpp
        src/pprint/js_pprint.cc
        src/pprint/js_pprint.hpp
        src/pprint/pprint.cc
        src/pprint/pprint.hpp
        src/rapidjson/error/en.h
        src/rapidjson/error/error.h
        src/rapidjson/internal/biginteger.h
        src/rapidjson/internal/diyfp.h
        src/rapidjson/internal/dtoa.h
        src/rapidjson/internal/ieee754.h
        src/rapidjson/internal/itoa.h
        src/rapidjson/internal/meta.h
        src/rapidjson/internal/pow10.h
        src/rapidjson/internal/stack.h
        src/rapidjson/internal/strfunc.h
        src/rapidjson/internal/strtod.h
        src/rapidjson/msinttypes/inttypes.h
        src/rapidjson/allocators.h
        src/rapidjson/document.h
        src/rapidjson/encodedstream.h
        src/rapidjson/encodings.h
        src/rapidjson/filereadstream.h
        src/rapidjson/filestream.h
        src/rapidjson/filewritestream.h
        src/rapidjson/memorybuffer.h
        src/rapidjson/memorystream.h
        src/rapidjson/prettywriter.h
        src/rapidjson/rapidjson.h
        src/rapidjson/reader.h
        src/rapidjson/stringbuffer.h
        src/rapidjson/writer.h
        src/rdb_protocol/artificial_table/artificial_table.cc
        src/rdb_protocol/artificial_table/artificial_table.hpp
        src/rdb_protocol/artificial_table/backend.cc
        src/rdb_protocol/artificial_table/backend.hpp
        src/rdb_protocol/artificial_table/caching_cfeed_backend.cc
        src/rdb_protocol/artificial_table/caching_cfeed_backend.hpp
        src/rdb_protocol/artificial_table/cfeed_backend.cc
        src/rdb_protocol/artificial_table/cfeed_backend.hpp
        src/rdb_protocol/artificial_table/in_memory.hpp
        src/rdb_protocol/datum_stream/array.hpp
        src/rdb_protocol/datum_stream/eq_join.hpp
        src/rdb_protocol/datum_stream/fold.hpp
        src/rdb_protocol/datum_stream/indexed_sort.hpp
        src/rdb_protocol/datum_stream/lazy.hpp
        src/rdb_protocol/datum_stream/map.hpp
        src/rdb_protocol/datum_stream/offsets_of.hpp
        src/rdb_protocol/datum_stream/ordered_distinct.hpp
        src/rdb_protocol/datum_stream/ordered_union.hpp
        src/rdb_protocol/datum_stream/range.hpp
        src/rdb_protocol/datum_stream/readers.hpp
        src/rdb_protocol/datum_stream/readgens.hpp
        src/rdb_protocol/datum_stream/slice.hpp
        src/rdb_protocol/datum_stream/union.hpp
        src/rdb_protocol/datum_stream/vector.hpp
        src/rdb_protocol/geo/karney/geodesic.cc
        src/rdb_protocol/geo/karney/geodesic.h
        src/rdb_protocol/geo/s2/base/basictypes.h
        src/rdb_protocol/geo/s2/base/casts.h
        src/rdb_protocol/geo/s2/base/docid.h
        src/rdb_protocol/geo/s2/base/int128.cc
        src/rdb_protocol/geo/s2/base/int128.h
        src/rdb_protocol/geo/s2/base/integral_types.h
        src/rdb_protocol/geo/s2/base/logging.cc
        src/rdb_protocol/geo/s2/base/logging.h
        src/rdb_protocol/geo/s2/base/macros.h
        src/rdb_protocol/geo/s2/base/port.h
        src/rdb_protocol/geo/s2/base/scoped_ptr.h
        src/rdb_protocol/geo/s2/base/stl_decl.h
        src/rdb_protocol/geo/s2/base/stl_decl_msvc.h
        src/rdb_protocol/geo/s2/base/stringprintf.cc
        src/rdb_protocol/geo/s2/base/stringprintf.h
        src/rdb_protocol/geo/s2/base/strtoint.cc
        src/rdb_protocol/geo/s2/base/strtoint.h
        src/rdb_protocol/geo/s2/base/template_util.h
        src/rdb_protocol/geo/s2/base/type_traits.h
        src/rdb_protocol/geo/s2/strings/ascii_ctype.cc
        src/rdb_protocol/geo/s2/strings/ascii_ctype.h
        src/rdb_protocol/geo/s2/strings/split.cc
        src/rdb_protocol/geo/s2/strings/split.h
        src/rdb_protocol/geo/s2/strings/stringprintf.cc
        src/rdb_protocol/geo/s2/strings/stringprintf.h
        src/rdb_protocol/geo/s2/strings/strutil.cc
        src/rdb_protocol/geo/s2/strings/strutil.h
        src/rdb_protocol/geo/s2/util/coding/coder.cc
        src/rdb_protocol/geo/s2/util/coding/coder.h
        src/rdb_protocol/geo/s2/util/coding/varint.cc
        src/rdb_protocol/geo/s2/util/coding/varint.h
        src/rdb_protocol/geo/s2/util/hash/hash_jenkins_lookup2.h
        src/rdb_protocol/geo/s2/util/math/exactfloat/exactfloat.cc
        src/rdb_protocol/geo/s2/util/math/exactfloat/exactfloat.h
        src/rdb_protocol/geo/s2/util/math/mathlimits.cc
        src/rdb_protocol/geo/s2/util/math/mathlimits.h
        src/rdb_protocol/geo/s2/util/math/mathutil.cc
        src/rdb_protocol/geo/s2/util/math/mathutil.h
        src/rdb_protocol/geo/s2/util/math/matrix3x3-inl.h
        src/rdb_protocol/geo/s2/util/math/matrix3x3.h
        src/rdb_protocol/geo/s2/util/math/vector2-inl.h
        src/rdb_protocol/geo/s2/util/math/vector2.h
        src/rdb_protocol/geo/s2/util/math/vector3-inl.h
        src/rdb_protocol/geo/s2/util/math/vector3.h
        src/rdb_protocol/geo/s2/util/math/vector4-inl.h
        src/rdb_protocol/geo/s2/util/math/vector4.h
        src/rdb_protocol/geo/s2/r1interval.h
        src/rdb_protocol/geo/s2/s1angle.cc
        src/rdb_protocol/geo/s2/s1angle.h
        src/rdb_protocol/geo/s2/s1interval.cc
        src/rdb_protocol/geo/s2/s1interval.h
        src/rdb_protocol/geo/s2/s2.cc
        src/rdb_protocol/geo/s2/s2.h
        src/rdb_protocol/geo/s2/s2cap.cc
        src/rdb_protocol/geo/s2/s2cap.h
        src/rdb_protocol/geo/s2/s2cell.cc
        src/rdb_protocol/geo/s2/s2cell.h
        src/rdb_protocol/geo/s2/s2cellid.cc
        src/rdb_protocol/geo/s2/s2cellid.h
        src/rdb_protocol/geo/s2/s2cellunion.cc
        src/rdb_protocol/geo/s2/s2cellunion.h
        src/rdb_protocol/geo/s2/s2edgeindex.cc
        src/rdb_protocol/geo/s2/s2edgeindex.h
        src/rdb_protocol/geo/s2/s2edgeutil.cc
        src/rdb_protocol/geo/s2/s2edgeutil.h
        src/rdb_protocol/geo/s2/s2latlng.cc
        src/rdb_protocol/geo/s2/s2latlng.h
        src/rdb_protocol/geo/s2/s2latlngrect.cc
        src/rdb_protocol/geo/s2/s2latlngrect.h
        src/rdb_protocol/geo/s2/s2loop.cc
        src/rdb_protocol/geo/s2/s2loop.h
        src/rdb_protocol/geo/s2/s2pointregion.cc
        src/rdb_protocol/geo/s2/s2pointregion.h
        src/rdb_protocol/geo/s2/s2polygon.cc
        src/rdb_protocol/geo/s2/s2polygon.h
        src/rdb_protocol/geo/s2/s2polygonbuilder.cc
        src/rdb_protocol/geo/s2/s2polygonbuilder.h
        src/rdb_protocol/geo/s2/s2polyline.cc
        src/rdb_protocol/geo/s2/s2polyline.h
        src/rdb_protocol/geo/s2/s2r2rect.cc
        src/rdb_protocol/geo/s2/s2r2rect.h
        src/rdb_protocol/geo/s2/s2region.cc
        src/rdb_protocol/geo/s2/s2region.h
        src/rdb_protocol/geo/s2/s2regioncoverer.cc
        src/rdb_protocol/geo/s2/s2regioncoverer.h
        src/rdb_protocol/geo/s2/s2regionintersection.cc
        src/rdb_protocol/geo/s2/s2regionintersection.h
        src/rdb_protocol/geo/s2/s2regionunion.cc
        src/rdb_protocol/geo/s2/s2regionunion.h
        src/rdb_protocol/geo/distances.cc
        src/rdb_protocol/geo/distances.hpp
        src/rdb_protocol/geo/ellipsoid.cc
        src/rdb_protocol/geo/ellipsoid.hpp
        src/rdb_protocol/geo/exceptions.hpp
        src/rdb_protocol/geo/geo_visitor.hpp
        src/rdb_protocol/geo/geojson.cc
        src/rdb_protocol/geo/geojson.hpp
        src/rdb_protocol/geo/inclusion.cc
        src/rdb_protocol/geo/inclusion.hpp
        src/rdb_protocol/geo/indexing.cc
        src/rdb_protocol/geo/indexing.hpp
        src/rdb_protocol/geo/intersection.cc
        src/rdb_protocol/geo/intersection.hpp
        src/rdb_protocol/geo/lon_lat_types.cc
        src/rdb_protocol/geo/lon_lat_types.hpp
        src/rdb_protocol/geo/primitives.cc
        src/rdb_protocol/geo/primitives.hpp
        src/rdb_protocol/terms/arith.cc
        src/rdb_protocol/terms/arr.cc
        src/rdb_protocol/terms/arr.hpp
        src/rdb_protocol/terms/case.cc
        src/rdb_protocol/terms/control.cc
        src/rdb_protocol/terms/datum_terms.cc
        src/rdb_protocol/terms/db_table.cc
        src/rdb_protocol/terms/error.cc
        src/rdb_protocol/terms/geo.cc
        src/rdb_protocol/terms/http.cc
        src/rdb_protocol/terms/js.cc
        src/rdb_protocol/terms/json.cc
        src/rdb_protocol/terms/obj.cc
        src/rdb_protocol/terms/obj_or_seq.cc
        src/rdb_protocol/terms/obj_or_seq.hpp
        src/rdb_protocol/terms/pred.cc
        src/rdb_protocol/terms/random.cc
        src/rdb_protocol/terms/rewrites.cc
        src/rdb_protocol/terms/seq.cc
        src/rdb_protocol/terms/sindex.cc
        src/rdb_protocol/terms/sort.cc
        src/rdb_protocol/terms/string.cc
        src/rdb_protocol/terms/terms.hpp
        src/rdb_protocol/terms/time.cc
        src/rdb_protocol/terms/type_manip.cc
        src/rdb_protocol/terms/uuid.cc
        src/rdb_protocol/terms/var.cc
        src/rdb_protocol/terms/write_hook.cc
        src/rdb_protocol/terms/write_hook.hpp
        src/rdb_protocol/terms/writes.cc
        src/rdb_protocol/terms/writes.hpp
        src/rdb_protocol/base64.cc
        src/rdb_protocol/base64.hpp
        src/rdb_protocol/batching.cc
        src/rdb_protocol/batching.hpp
        src/rdb_protocol/blob_wrapper.cc
        src/rdb_protocol/blob_wrapper.hpp
        src/rdb_protocol/btree.cc
        src/rdb_protocol/btree.hpp
        src/rdb_protocol/btree_store.cc
        src/rdb_protocol/changefeed.cc
        src/rdb_protocol/changefeed.hpp
        src/rdb_protocol/configured_limits.cc
        src/rdb_protocol/configured_limits.hpp
        src/rdb_protocol/context.cc
        src/rdb_protocol/context.hpp
        src/rdb_protocol/datum.cc
        src/rdb_protocol/datum.hpp
        src/rdb_protocol/datum_stream.cc
        src/rdb_protocol/datum_stream.hpp
        src/rdb_protocol/datum_string.cc
        src/rdb_protocol/datum_string.hpp
        src/rdb_protocol/datum_utils.hpp
        src/rdb_protocol/datumspec.cc
        src/rdb_protocol/datumspec.hpp
        src/rdb_protocol/distribution_progress.cc
        src/rdb_protocol/distribution_progress.hpp
        src/rdb_protocol/env.cc
        src/rdb_protocol/env.hpp
        src/rdb_protocol/erase_range.cc
        src/rdb_protocol/erase_range.hpp
        src/rdb_protocol/error.cc
        src/rdb_protocol/error.hpp
        src/rdb_protocol/func.cc
        src/rdb_protocol/func.hpp
        src/rdb_protocol/geo_traversal.cc
        src/rdb_protocol/geo_traversal.hpp
        src/rdb_protocol/lazy_btree_val.cc
        src/rdb_protocol/lazy_btree_val.hpp
        src/rdb_protocol/math_utils.hpp
        src/rdb_protocol/minidriver.cc
        src/rdb_protocol/minidriver.hpp
        src/rdb_protocol/op.cc
        src/rdb_protocol/op.hpp
        src/rdb_protocol/optargs.cc
        src/rdb_protocol/optargs.hpp
        src/rdb_protocol/order_util.cc
        src/rdb_protocol/order_util.hpp
        src/rdb_protocol/pathspec.cc
        src/rdb_protocol/pathspec.hpp
        src/rdb_protocol/profile.cc
        src/rdb_protocol/profile.hpp
        src/rdb_protocol/protocol.cc
        src/rdb_protocol/protocol.hpp
        src/rdb_protocol/pseudo_binary.cc
        src/rdb_protocol/pseudo_binary.hpp
        src/rdb_protocol/pseudo_geometry.cc
        src/rdb_protocol/pseudo_geometry.hpp
        src/rdb_protocol/pseudo_literal.cc
        src/rdb_protocol/pseudo_literal.hpp
        src/rdb_protocol/pseudo_time.cc
        src/rdb_protocol/pseudo_time.hpp
        src/rdb_protocol/ql2proto.hpp
        src/rdb_protocol/query_cache.cc
        src/rdb_protocol/query_cache.hpp
        src/rdb_protocol/query_params.cc
        src/rdb_protocol/query_params.hpp
        src/rdb_protocol/query_server.cc
        src/rdb_protocol/query_server.hpp
        src/rdb_protocol/rdb_backtrace.cc
        src/rdb_protocol/rdb_backtrace.hpp
        src/rdb_protocol/real_table.cc
        src/rdb_protocol/real_table.hpp
        src/rdb_protocol/response.cc
        src/rdb_protocol/response.hpp
        src/rdb_protocol/serialize_datum.cc
        src/rdb_protocol/serialize_datum.hpp
        src/rdb_protocol/serialize_datum_onto_blob.hpp
        src/rdb_protocol/shards.cc
        src/rdb_protocol/shards.hpp
        src/rdb_protocol/store.cc
        src/rdb_protocol/store.hpp
        src/rdb_protocol/store_metainfo.cc
        src/rdb_protocol/store_metainfo.hpp
        src/rdb_protocol/store_receive_backfill.cc
        src/rdb_protocol/store_send_backfill.cc
        src/rdb_protocol/sym.cc
        src/rdb_protocol/sym.hpp
        src/rdb_protocol/table_common.cc
        src/rdb_protocol/table_common.hpp
        src/rdb_protocol/term.cc
        src/rdb_protocol/term.hpp
        src/rdb_protocol/term_storage.cc
        src/rdb_protocol/term_storage.hpp
        src/rdb_protocol/term_walker.cc
        src/rdb_protocol/term_walker.hpp
        src/rdb_protocol/val.cc
        src/rdb_protocol/val.hpp
        src/rdb_protocol/var_types.cc
        src/rdb_protocol/var_types.hpp
        src/rdb_protocol/wire_func.cc
        src/rdb_protocol/wire_func.hpp
        src/region/hash_region.cc
        src/region/hash_region.hpp
        src/region/region.cc
        src/region/region.hpp
        src/region/region_map.hpp
        src/rpc/connectivity/cluster.cc
        src/rpc/connectivity/cluster.hpp
        src/rpc/connectivity/peer_id.cc
        src/rpc/connectivity/peer_id.hpp
        src/rpc/connectivity/server_id.cc
        src/rpc/connectivity/server_id.hpp
        src/rpc/directory/map_read_manager.cc
        src/rpc/directory/map_read_manager.hpp
        src/rpc/directory/map_read_manager.tcc
        src/rpc/directory/map_write_manager.cc
        src/rpc/directory/map_write_manager.hpp
        src/rpc/directory/map_write_manager.tcc
        src/rpc/directory/read_manager.cc
        src/rpc/directory/read_manager.hpp
        src/rpc/directory/read_manager.tcc
        src/rpc/directory/write_manager.cc
        src/rpc/directory/write_manager.hpp
        src/rpc/directory/write_manager.tcc
        src/rpc/mailbox/mailbox.cc
        src/rpc/mailbox/mailbox.hpp
        src/rpc/mailbox/typed.hpp
        src/rpc/semilattice/joins/deletable.hpp
        src/rpc/semilattice/joins/deletable.tcc
        src/rpc/semilattice/joins/macros.hpp
        src/rpc/semilattice/joins/map.hpp
        src/rpc/semilattice/joins/set.hpp
        src/rpc/semilattice/joins/versioned.hpp
        src/rpc/semilattice/view/field.hpp
        src/rpc/semilattice/view/field.tcc
        src/rpc/semilattice/view/member.hpp
        src/rpc/semilattice/view/member.tcc
        src/rpc/semilattice/semilattice_manager.cc
        src/rpc/semilattice/semilattice_manager.hpp
        src/rpc/semilattice/semilattice_manager.tcc
        src/rpc/semilattice/view.hpp
        src/rpc/semilattice/watchable.hpp
        src/rpc/serialize_macros.hpp
        src/serializer/log/lba/disk_extent.cc
        src/serializer/log/lba/disk_extent.hpp
        src/serializer/log/lba/disk_format.hpp
        src/serializer/log/lba/disk_structure.cc
        src/serializer/log/lba/disk_structure.hpp
        src/serializer/log/lba/extent.cc
        src/serializer/log/lba/extent.hpp
        src/serializer/log/lba/in_memory_index.cc
        src/serializer/log/lba/in_memory_index.hpp
        src/serializer/log/lba/lba_list.cc
        src/serializer/log/lba/lba_list.hpp
        src/serializer/log/config.hpp
        src/serializer/log/data_block_manager.cc
        src/serializer/log/data_block_manager.hpp
        src/serializer/log/extent_manager.cc
        src/serializer/log/extent_manager.hpp
        src/serializer/log/log_serializer.cc
        src/serializer/log/log_serializer.hpp
        src/serializer/log/metablock.hpp
        src/serializer/log/metablock_manager.cc
        src/serializer/log/metablock_manager.hpp
        src/serializer/log/static_header.cc
        src/serializer/log/static_header.hpp
        src/serializer/log/stats.hpp
        src/serializer/log/types.hpp
        src/serializer/buf_ptr.cc
        src/serializer/buf_ptr.hpp
        src/serializer/checksum.cc
        src/serializer/checksum.hpp
        src/serializer/merger.cc
        src/serializer/merger.hpp
        src/serializer/serializer.cc
        src/serializer/serializer.hpp
        src/serializer/translator.cc
        src/serializer/translator.hpp
        src/serializer/types.hpp
        src/activity_logger.cc
        src/activity_logger.hpp
        src/assignment_sentry.hpp
        src/backtrace.cc
        src/backtrace.hpp
        src/debug.cc
        src/debug.hpp
        src/do_on_thread.hpp
        src/errors.cc
        src/errors.hpp
        src/logger.hpp
        src/main.cc
        src/math.cc
        src/math.hpp
        src/memory_utils.cc
        src/memory_utils.hpp
        src/paths.cc
        src/paths.hpp
        src/protocol_api.cc
        src/protocol_api.hpp
        src/random.cc
        src/random.hpp
        src/repli_timestamp.cc
        src/repli_timestamp.hpp
        src/rethinkdb_backtrace.cc
        src/rethinkdb_backtrace.hpp
        src/stl_utils.cc
        src/stl_utils.hpp
        src/stl_utils.tcc
        src/store_subview.hpp
        src/store_view.hpp
        src/thread_local.hpp
        src/threading.cc
        src/threading.hpp
        src/time.cc
        src/time.hpp
        src/timestamps.cc
        src/timestamps.hpp
        src/utils.cc
        src/utils.hpp
        src/valgrind.hpp
        src/version.hpp)

if (${MSVC} OR ${WIN32})
    list(APPEND rebirthdb_SOURCES
            src/arch/windows_stub/pthread.cc
            src/arch/windows_stub/pthread.h
            src/rapidjson/msinttypes/stdint.h
            src/rdb_protocol/geo/s2/util/endian/endian.h
            src/windows.hpp)
endif()



##########################################################################################
###########################            REBIRTHDB              ############################
##########################################################################################

add_executable(rebirthdb ${rebirthdb_SOURCES})

set(THREADS_PREFER_PTHREAD_FLAG ON)
find_package(Threads REQUIRED)

set(rebirthdb_EXTERNAL_LIBRARIES)
list(APPEND rebirthdb_EXTERNAL_LIBRARIES
        ${re2_STATIC_LIBRARIES}
        ${zlib_STATIC_LIBRARIES}
        ${gotten_zlib_LINK_FLAGS}
        ${curl_STATIC_LIBRARIES}
        ${gotten_curl_LINK_FLAGS}
        ${protobuf_STATIC_LIBRARIES}
        Threads::Threads
        ${jemalloc_STATIC_LIBRARIES}
        ${gotten_jemalloc_LINK_FLAGS})

if (${UNIX} AND NOT ${APPLE})
    list(APPEND rebirthdb_EXTERNAL_LIBRARIES rt)
endif()

list(APPEND rebirthdb_EXTERNAL_LIBRARIES
        "-rdynamic"    # -rdynamic is necessary so that backtrace_symbols() works properly
        ${openssl_STATIC_LIBRARIES}
        ${gotten_openssl_LINK_FLAGS})

target_link_libraries(rebirthdb ${rebirthdb_EXTERNAL_LIBRARIES})

set(rebirthdb_EXTERNAL_DEPENDENCIES)
list(APPEND rebirthdb_EXTERNAL_DEPENDENCIES
        boost
        zlib_copy_headers_to_destination
        protobuf
        re2
        duktape
        libidn
        jemalloc
        openssl
        curl
        gtest)

add_dependencies(curl openssl zlib)

add_dependencies(rebirthdb
        ${rebirthdb_EXTERNAL_DEPENDENCIES})

# Regenerate configuration after compilation, just before linking
# so that cmake's links.txt is generated correctly
add_custom_command(TARGET rebirthdb
        PRE_LINK
        COMMAND ${CMAKE_COMMAND} .
        WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
        COMMENT "Regenerating configuration for updated link flags")




##########################################################################################
######################           REBIRTHDB UNITTESTS              ########################
##########################################################################################

set(rebirthdb_unittest_SOURCES
        src/unittest/archive_test.cc
        src/unittest/auth_key_test.cc
        src/unittest/barrier_test.cc
        src/unittest/bignum_test.cc
        src/unittest/blob_test.cc
        src/unittest/branch_history_manager.cc
        src/unittest/branch_history_manager.hpp
        src/unittest/btree_metadata.cc
        src/unittest/btree_metainfo.cc
        src/unittest/btree_sindex.cc
        src/unittest/btree_utils.hpp
        src/unittest/btree_whole.cc
        src/unittest/clone_ptr.cc
        src/unittest/clustering_backfill.cc
        src/unittest/clustering_branch.cc
        src/unittest/clustering_branch_history.cc
        src/unittest/clustering_contract_coordinator.cc
        src/unittest/clustering_contract_executor.cc
        src/unittest/clustering_contract_utils.cc
        src/unittest/clustering_contract_utils.hpp
        src/unittest/clustering_minidir.cc
        src/unittest/clustering_query.cc
        src/unittest/clustering_raft.cc
        src/unittest/clustering_raft_fuzzer.cc
        src/unittest/clustering_raft_storage.cc
        src/unittest/clustering_registration.cc
        src/unittest/clustering_utils.cc
        src/unittest/clustering_utils.hpp
        src/unittest/clustering_utils_raft.cc
        src/unittest/clustering_utils_raft.hpp
        src/unittest/context_switching.cc
        src/unittest/coroutine_utils.cc
        src/unittest/coroutines.cc
        src/unittest/cross_thread_watchable.cc
        src/unittest/datum_test.cc
        src/unittest/dbm_test.cc
        src/unittest/disk_backed_queue.cc
        src/unittest/disk_conflict_resolution.cc
        src/unittest/disk_format_test.cc
        src/unittest/dummy_metadata_controller.hpp
        src/unittest/dummy_namespace_interface.cc
        src/unittest/dummy_namespace_interface.hpp
        src/unittest/extproc_test.cc
        src/unittest/extproc_test.hpp
        src/unittest/fifo_enforcer.cc
        src/unittest/geo_btree.cc
        src/unittest/geo_indexes.cc
        src/unittest/geo_primitives.cc
        src/unittest/gtest.hpp
        src/unittest/hash_region_test.cc
        src/unittest/http.cc
        src/unittest/http_escaping.cc
        src/unittest/internal_node_test.cc
        src/unittest/jsproc.cc
        src/unittest/leaf_node_test.cc
        src/unittest/log_message.cc
        src/unittest/lru_cache_test.cc
        src/unittest/main.cc
        src/unittest/mock_file.cc
        src/unittest/mock_file.hpp
        src/unittest/mock_store.cc
        src/unittest/mock_store.hpp
        src/unittest/optional.cc
        src/unittest/options_test.cc
        src/unittest/page_test.cc
        src/unittest/perfmon_tests.cc
        src/unittest/pprint_test.cc
        src/unittest/print_secondary.cc
        src/unittest/printf_buffer_test.cc
        src/unittest/range_map.cc
        src/unittest/rdb_backfill.cc
        src/unittest/rdb_btree.cc
        src/unittest/rdb_env.cc
        src/unittest/rdb_env.hpp
        src/unittest/rdb_interruptor.cc
        src/unittest/rdb_protocol.cc
        src/unittest/rdb_protocol.hpp
        src/unittest/rebalance.cc
        src/unittest/region_map_test.cc
        src/unittest/rpc_connectivity.cc
        src/unittest/rpc_directory.cc
        src/unittest/rpc_mailbox.cc
        src/unittest/rpc_semilattice.cc
        src/unittest/rwlock_test.cc
        src/unittest/serializer_test.cc
        src/unittest/server_id_test.cc
        src/unittest/sizeof_test.cc
        src/unittest/timer_test.cc
        src/unittest/unittest_utils.cc
        src/unittest/unittest_utils.hpp
        src/unittest/utf8.cc
        src/unittest/utils_test.cc
        src/unittest/uuid_test.cc
        src/unittest/varint_test.cc)
set(rebirthdb_SOURCES_NOMAIN ${rebirthdb_SOURCES})

list(REMOVE_ITEM rebirthdb_SOURCES_NOMAIN src/main.cc)

set(rebirthdb_unittest_SOURCES
        ${rebirthdb_SOURCES_NOMAIN}
        ${rebirthdb_unittest_SOURCES})

set(rebirthdb_unittest_EXTERNAL_LIBRARIES
        ${rebirthdb_EXTERNAL_LIBRARIES}
        ${gtest_STATIC_LIBRARIES})

set(rebirthdb_unittest_EXTERNAL_DEPENDENCIES
        ${rebirthdb_EXTERNAL_DEPENDENCIES})

add_executable(rebirthdb-unittest ${rebirthdb_unittest_SOURCES})

target_link_libraries(rebirthdb-unittest ${rebirthdb_unittest_EXTERNAL_LIBRARIES})

add_dependencies(rebirthdb-unittest ${rebirthdb_unittest_EXTERNAL_DEPENDENCIES})

# Regenerate configuration after compilation, just before linking
# so that cmake's links.txt is generated correctly
add_custom_command(TARGET rebirthdb-unittest
        PRE_LINK
        COMMAND ${CMAKE_COMMAND} .
        WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
        COMMENT "Regenerating configuration for updated link flags")


##########################################################################################
######################                     ALL                    ########################
##########################################################################################

add_custom_target(default)
add_dependencies(default rebirthdb rebirthdb-unittest)

set(GDB_FUNCTIONS_INPUT ${PROJECT_SOURCE_DIR}/scripts/${GDB_FUNCTIONS_NAME})
set(GDB_FUNCTIONS_OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${GDB_FUNCTIONS_NAME})
configure_file(${GDB_FUNCTIONS_INPUT} ${GDB_FUNCTIONS_OUTPUT} COPYONLY)
